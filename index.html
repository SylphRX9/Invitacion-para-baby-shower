<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Baby Shower ‚Ä¢ Invitaci√≥n</title>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --rosa:#ff4d8d;
  --azul:#1e90ff;
  --papel:#fff8f2;
  --cielo:#eaf6ff;
  --negro:#1f2937;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background: linear-gradient(135deg, var(--azul), var(--rosa));
  overflow:hidden;
  color:#263238;
}

/* [Mant√©n todos tus estilos CSS existentes aqu√≠] */
/* ... todo tu CSS anterior permanece igual ... */

/* ====== RESPONSIVE ====== */
@media (max-width:560px){
  .voto-wrap{ grid-template-columns: 1fr; }
  .barra{ height:200px; }
}
</style>
</head>
<body>

<!-- [Todo tu HTML anterior permanece igual] -->
<!-- ====== FONDO ESPIRAL ====== -->
<svg id="bg-spiral" viewBox="0 0 1000 1000" preserveAspectRatio="none">
  <!-- ... contenido del SVG ... -->
</svg>

<!-- ====== BURBUJAS ====== -->
<div id="burbujas" aria-hidden="true"></div>

<!-- ====== PATITOS ====== -->
<div id="patos" aria-hidden="true"></div>

<!-- ====== INTRO ====== -->
<div class="center" id="intro">
  <div>
    <span id="emojiSobre">‚úâÔ∏è</span>
    <button class="btn" id="abrirBtn">¬°ABRIR INVITACI√ìN!</button>
  </div>
</div>

<!-- FLASH -->
<div id="flash"></div>

<!-- ====== P√ÅGINAS ====== -->
<div class="center" id="paginas">
  <div class="hoja" id="hoja1">
    <h2 class="titulo">üçº VOTACIONES</h2>
    <p class="sub">¬°Vota! ¬øSer√° <span style="color:var(--azul);font-weight:800;">NI√ëO</span> o <span style="color:var(--rosa);font-weight:800;">NI√ëA</span>?</p>

    <div class="voto-wrap">
      <!-- NI√ëO -->
      <div>
        <div class="barra">
          <div class="llenado" id="barAzul" style="--color: rgba(30,144,255,.9); --h:10%"></div>
        </div>
        <div class="voto-card">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 64 40" width="24" height="24">
              <path d="M8 24 L20 12 H44 L56 24 V34 H8 Z" fill="#1e90ff"/>
              <circle cx="20" cy="34" r="5" fill="#0b3a78"/>
              <circle cx="44" cy="34" r="5" fill="#0b3a78"/>
              <rect x="24" y="14" width="14" height="6" fill="#bde0ff" rx="2"/>
            </svg>
          </span>
          <span>NI√ëO</span>
        </div>
        <button class="voto-btn" id="votaNino">Votar NI√ëO</button>
        <div class="contador"><span id="countNino">0</span> votos</div>
      </div>

      <!-- NI√ëA -->
      <div>
        <div class="barra">
          <div class="llenado" id="barRosa" style="--color: rgba(255,77,141,.9); --h:10%"></div>
        </div>
        <div class="voto-card">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 64 40" width="24" height="24">
              <path d="M12 20 C6 6, 26 6, 32 18 C38 6, 58 6, 52 20 C58 34, 38 34, 32 22 C26 34, 6 34, 12 20 Z" fill="#ff4d8d"/>
              <circle cx="32" cy="20" r="5" fill="#ff79a8"/>
            </svg>
          </span>
          <span>NI√ëA</span>
        </div>
        <button class="voto-btn" id="votaNina">Votar NI√ëA</button>
        <div class="contador"><span id="countNina">0</span> votos</div>
      </div>
    </div>

    <div class="navegacion">
      <button class="navbtn" onclick="mostrarPagina(2)">Siguiente ‚ûú</button>
    </div>
  </div>

  <!-- ... otras p√°ginas ... -->
</div>

<!-- AUDIO -->
<audio id="bgMusic" src="DeFondo2.mp3" preload="auto" loop></audio>
<button id="muteBtn" title="Silenciar/Activar">üîá</button>

<!-- ====== SCRIPTS ====== -->
<script>
// ******************************************************************
// CONFIGURACI√ìN FIREBASE - ¬°REMPLAZA CON TUS VALORES REALES!
// ******************************************************************
const firebaseConfig = {
  apiKey: "TU_API_KEY_REAL_AQUI",
  authDomain: "tu-proyecto-real.firebaseapp.com",
  projectId: "tu-project-id-real",
  storageBucket: "tu-proyecto-real.appspot.com",
  messagingSenderId: "123456789012",
  appId: "1:123456789012:web:tu-app-id-real"
};

// Inicializar Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Referencia a la colecci√≥n de votos
const votesRef = db.collection("babyShowerVotes");
const mainVoteDoc = votesRef.doc("votosGlobales");

// ******************************************************************
// Variables globales
// ******************************************************************
let votosNino = 0;
let votosNina = 0;
let hasVoted = localStorage.getItem('hasVoted') === 'true';

// ******************************************************************
// FUNCI√ìN: Cargar votos desde Firebase
// ******************************************************************
function cargarVotos() {
  mainVoteDoc.get().then((doc) => {
    if (doc.exists) {
      const data = doc.data();
      votosNino = data.nino || 0;
      votosNina = data.nina || 0;
      renderVotos();
      
      // Si ya vot√≥, deshabilitar botones
      if (hasVoted) {
        document.getElementById('votaNino').disabled = true;
        document.getElementById('votaNina').disabled = true;
        document.getElementById('votaNino').textContent = "Ya votaste ‚úì";
        document.getElementById('votaNina').textContent = "Ya votaste ‚úì";
      }
    } else {
      // Crear documento si no existe
      mainVoteDoc.set({ nino: 0, nina: 0 });
    }
  }).catch((error) => {
    console.error("Error cargando votos:", error);
  });
}

// ******************************************************************
// FUNCI√ìN: Escuchar cambios en tiempo real
// ******************************************************************
function escucharVotosEnTiempoReal() {
  mainVoteDoc.onSnapshot((doc) => {
    if (doc.exists) {
      const data = doc.data();
      votosNino = data.nino || 0;
      votosNina = data.nina || 0;
      renderVotos();
    }
  }, (error) => {
    console.error("Error en tiempo real:", error);
  });
}

// ******************************************************************
// FUNCI√ìN: Votar
// ******************************************************************
function votar(opcion) {
  if (hasVoted) {
    alert("¬°Ya has votado! Solo se permite un voto por persona.");
    return;
  }
  
  const btn = document.getElementById(opcion === 'nino' ? 'votaNino' : 'votaNina');
  const textoOriginal = btn.textContent;
  
  // Mostrar loading
  btn.disabled = true;
  btn.textContent = "Votando...";
  
  // Actualizar en Firebase
  const updateData = {};
  updateData[opcion] = firebase.firestore.FieldValue.increment(1);
  
  mainVoteDoc.update(updateData)
    .then(() => {
      // Marcar que ya vot√≥
      hasVoted = true;
      localStorage.setItem('hasVoted', 'true');
      
      // Deshabilitar ambos botones
      document.getElementById('votaNino').disabled = true;
      document.getElementById('votaNina').disabled = true;
      document.getElementById('votaNino').textContent = "¬°Gracias por votar!";
      document.getElementById('votaNina').textContent = "¬°Gracias por votar!";
    })
    .catch((error) => {
      console.error("Error al votar:", error);
      alert("Ocurri√≥ un error. Intenta nuevamente.");
      
      // Restaurar bot√≥n
      btn.disabled = false;
      btn.textContent = textoOriginal;
    });
}

// ******************************************************************
// FUNCI√ìN: Renderizar votos (igual que antes)
// ******************************************************************
function renderVotos(){
  const total = Math.max(1, votosNino + votosNina);
  const pA = Math.round((votosNino/total)*100);
  const pR = 100 - pA;
  
  const barAzul = document.getElementById('barAzul');
  const barRosa = document.getElementById('barRosa');
  const countNino = document.getElementById('countNino');
  const countNina = document.getElementById('countNina');
  
  barAzul.style.setProperty('--h', Math.max(6, pA) + '%');
  barRosa.style.setProperty('--h', Math.max(6, pR) + '%');
  countNino.textContent = votosNino;
  countNina.textContent = votosNina;
}

// ******************************************************************
// EVENT LISTENERS para votaci√≥n
// ******************************************************************
document.getElementById('votaNino').addEventListener('click', () => votar('nino'));
document.getElementById('votaNina').addEventListener('click', () => votar('nina'));

// ******************************************************************
// INICIALIZACI√ìN
// ******************************************************************
document.addEventListener('DOMContentLoaded', function() {
  cargarVotos();
  escucharVotosEnTiempoReal();
});

// ******************************************************************
// [El resto de tu c√≥digo JavaScript permanece IGUAL]
// ******************************************************************

/* ====== BURBUJAS DIN√ÅMICAS ====== */
const burbujas = document.getElementById('burbujas');
for(let i=0;i<24;i++){
  const b = document.createElementNS('http://www.w3.org/2000/svg','svg');
  b.setAttribute('viewBox','0 0 64 64');
  b.classList.add('burbuja');
  b.style.left = Math.random()*100 + 'vw';
  b.style.setProperty('--s', (18 + Math.random()*36) + 'px');
  b.style.setProperty('--x', (-40 + Math.random()*80) + 'px');
  b.style.setProperty('--drift', (60 + Math.random()*160) + 'px');
  b.style.setProperty('--dur', (9 + Math.random()*7) + 's');
  b.style.animationDelay = (Math.random()*-12) + 's';
  b.innerHTML = `
    <defs>
      <radialGradient id="g${i}">
        <stop offset="0%" stop-color="#ffffff" stop-opacity=".9"/>
        <stop offset="70%" stop-color="#aee1ff" stop-opacity=".6"/>
        <stop offset="100%" stop-color="#6ec6ff" stop-opacity=".0"/>
      </radialGradient>
    </defs>
    <circle cx="32" cy="32" r="30" fill="url(#g${i})" />
  `;
  burbujas.appendChild(b);
}

/* ====== PATITOS DIN√ÅMICOS (SVG) ====== */
const patos = document.getElementById('patos');
function patoSVG(){
  const d = document.createElement('div');
  d.className = 'pato';
  d.style.left = Math.random()*100 + 'vw';
  d.style.animationDuration = (10 + Math.random()*8) + 's';
  d.style.opacity = .8;
  d.innerHTML = `
    <svg viewBox="0 0 64 48" width="64" height="48">
      <path d="M12 30c-6 0-10-6-8-10 4 2 8 0 10-4 1-3 0-6 4-8 5-3 12 1 12 6 8-6 18-2 18 6 10 2 12 14 2 20-8 5-34 5-38-10z" fill="#ffdf6e" stroke="#e0b84a" stroke-width="1"/>
      <path d="M46 20 l8 -2 v6 l-8 -2 z" fill="#ff8b3d"/>
      <circle cx="40" cy="18" r="2" fill="#333"/>
    </svg>
  `;
  return d;
}
for(let i=0;i<10;i++){
  const p = patoSVG();
  p.style.animationDelay = (Math.random()*-14)+'s';
  patos.appendChild(p);
}
// nuevos patos espor√°dicos
setInterval(()=>{ patos.appendChild(patoSVG()); }, 5000);

/* ====== REFERENCIAS UI ====== */
const abrirBtn = document.getElementById('abrirBtn');
const emojiSobre = document.getElementById('emojiSobre');
const flash = document.getElementById('flash');
const intro = document.getElementById('intro');
const paginas = document.getElementById('paginas');
const bgMusic = document.getElementById('bgMusic');
const muteBtn = document.getElementById('muteBtn');

/* ====== PAGINACI√ìN ====== */
function mostrarPagina(n){
  const hojas = ['hoja1','hoja2','hoja3','hoja4'];
  hojas.forEach((id,i)=>{
    document.getElementById(id).style.display = (i===n-1)?'block':'none';
  });
}

/* ====== AUDIO MUTE/UNMUTE ====== */
let muted = true;
function updateMuteUI(){
  muteBtn.textContent = muted ? 'üîá' : 'üîä';
  bgMusic.muted = muted;
}
muteBtn.addEventListener('click', async ()=>{
  if(bgMusic.paused){
    try{ await bgMusic.play(); }catch(e){}
  }
  muted = !muted;
  updateMuteUI();
});
updateMuteUI();

/* ====== INTRO: abrir invitaci√≥n ====== */
abrirBtn.addEventListener('click', async ()=>{
  emojiSobre.classList.add('shake');
  setTimeout(()=> emojiSobre.classList.remove('shake'), 600);

  try{
    await bgMusic.play();
  }catch(e){}
  
  updateMuteUI();

  setTimeout(()=>{
    flash.classList.add('mostrar');
    setTimeout(()=>{
      flash.classList.remove('mostrar');
      intro.style.display = 'none';
      paginas.style.display = 'grid';
      mostrarPagina(1);
    }, 900);
  }, 300);
});
</script>
</body>
</html>
